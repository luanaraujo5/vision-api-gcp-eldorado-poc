<div class="vision-container">
  <!-- Left Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="/logo-branco.svg" alt="Logo da Empresa" class="company-logo">
    </div>
    
    <nav class="sidebar-nav">
      <div class="nav-item">
        <span class="nav-icon">üìä</span>
        <span class="nav-text">Vision API</span>
      </div>
      <div class="nav-item active">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span class="nav-text">Configura√ß√µes</span>
      </div>
    </nav>
    
    <div class="sidebar-footer">
      <button class="logout-btn">
        <span class="nav-icon">üö™</span>
        <span class="nav-text">Sair</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Page Header -->
    <header class="page-header">
      <h1 class="page-title">Configura√ß√µes</h1>
      
      <!-- Sub-navigation Tabs -->
      <div class="sub-nav">
        <div class="tab active">
          <span class="tab-icon">üîç</span>
          <span class="tab-text">An√°lise de Imagem</span>
        </div>
      </div>
    </header>

    <!-- Error Banner -->
    <div *ngIf="error" class="error-banner">
      <div class="error-content">
        <span class="error-icon">‚ö†Ô∏è</span>
        <span class="error-text">{{ error }}</span>
        <button (click)="clearError()" class="error-close" aria-label="Fechar erro">
          <span>√ó</span>
        </button>
      </div>
    </div>

    <!-- Vision Analysis Section -->
    <section class="content-section">
      <div class="section-header">
        <h2>Configura√ß√£o de An√°lise de Imagem</h2>
        <p>Configure e analise imagens usando a API Google Vision</p>
      </div>

      <!-- Image Upload Area -->
      <div class="upload-container">
        <div class="upload-area" (click)="fileInput.click()" [class.has-image]="imagePreview">
          <div *ngIf="!imagePreview" class="upload-placeholder">
            <div class="upload-icon">üìÅ</div>
            <h3>Escolher Imagem</h3>
            <p>Clique para selecionar ou arraste uma imagem aqui</p>
            <span class="upload-formats">JPG, PNG, GIF, BMP</span>
          </div>
          
          <div *ngIf="imagePreview" class="image-preview-container">
            <img [src]="imagePreview" alt="Visualiza√ß√£o da imagem" class="image-preview">
            <div class="image-overlay">
              <button class="change-image-btn">üîÑ Trocar Imagem</button>
            </div>
          </div>
        </div>

        <input #fileInput type="file" accept="image/*" (change)="onImageSelected($event)" class="file-input">
        
        <div class="upload-actions">
          <button (click)="fileInput.click()" class="btn btn-primary">
            <span class="btn-icon">üìÅ</span>
            Escolher Arquivo
          </button>
          <button *ngIf="imagePreview" (click)="clearAll()" class="btn btn-secondary">
            <span class="btn-icon">üóëÔ∏è</span>
            Limpar
          </button>
        </div>
      </div>

      <!-- Detection Types Selection -->
      <div class="detection-section" *ngIf="imagePreview" id="detection-section">
        <div class="section-header">
          <h3>Tipos de Detec√ß√£o</h3>
          <p>Selecione quais tipos de an√°lise deseja realizar</p>
          <div class="selection-counter">
            <span class="counter-badge">{{ getSelectedCount() }}</span>
            de {{ detectionOptions.length }} selecionados
          </div>
        </div>

        <div class="detection-grid">
          <div 
            *ngFor="let option of detectionOptions" 
            class="detection-card"
            [class.selected]="isDetectionSelected(option.value)"
            (click)="toggleDetection(option.value)"
          >
            <div class="card-header">
              <div class="card-icon">{{ option.icon }}</div>
              <div class="card-content">
                <h4 class="card-title">{{ option.label }}</h4>
                <p class="card-description">{{ option.description }}</p>
              </div>
              <div class="selection-indicator">
                <div class="checkbox" [class.checked]="isDetectionSelected(option.value)">
                  <span *ngIf="isDetectionSelected(option.value)" class="checkmark">‚úì</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Configuration Panel -->
        <div class="config-panel">
          <div class="config-item">
            <label for="maxResults" class="config-label">
              <span class="config-icon">‚öôÔ∏è</span>
              M√°ximo de Resultados:
            </label>
            <div class="config-control">
              <input 
                type="range" 
                id="maxResults" 
                [(ngModel)]="maxResults" 
                min="1" 
                max="20" 
                class="range-slider"
              >
              <span class="range-value">{{ maxResults }}</span>
            </div>
          </div>
        </div>

        <!-- Analysis Button -->
        <div class="analysis-actions">
          <button 
            (click)="analyzeImage()" 
            [disabled]="!canAnalyze()" 
            class="btn btn-save"
            [class.loading]="loading"
          >
            <span *ngIf="!loading" class="btn-content">
              <span class="btn-icon">üîç</span>
              Analisar Imagem
            </span>
            <span *ngIf="loading" class="btn-content">
              <span class="loading-spinner"></span>
              Analisando...
            </span>
          </button>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-section">
        <div class="loading-container">
          <div class="loading-animation">
            <div class="loading-circle"></div>
            <div class="loading-circle"></div>
            <div class="loading-circle"></div>
          </div>
          <h3>Analisando sua imagem...</h3>
          <p>Isso pode levar alguns segundos</p>
        </div>
      </div>

      <!-- Results Section -->
      <div *ngIf="results && !loading" class="results-section">
        <div class="section-header">
          <h3>Resultados da An√°lise</h3>
          <p>Detalhes encontrados na sua imagem</p>
        </div>

        <div class="results-container">
          <!-- Face Detection -->
          <div *ngIf="results.responses?.[0]?.faceAnnotations?.length" class="result-card">
            <div class="result-header">
              <span class="result-icon">üòä</span>
              <h4>Detec√ß√£o de Rosto</h4>
              <span class="result-count">{{ results.responses[0].faceAnnotations?.length || 0 }} rosto(s)</span>
            </div>
            <div class="result-content">
              <div *ngFor="let face of results.responses[0]?.faceAnnotations || []; let i = index" class="face-item">
                <div class="face-header">
                  <h5>Rosto {{ i + 1 }}</h5>
                  <span class="confidence-badge">
                    {{ (face.detectionConfidence * 100).toFixed(0) }}%
                  </span>
                </div>
                <div class="emotions-grid">
                  <div *ngIf="face.joyLikelihood" class="emotion-item">
                    <span class="emotion-icon">üòä</span>
                    <span class="emotion-label">Alegria</span>
                    <span class="emotion-value">{{ face.joyLikelihood }}</span>
                  </div>
                  <div *ngIf="face.sorrowLikelihood" class="emotion-item">
                    <span class="emotion-icon">üò¢</span>
                    <span class="emotion-label">Tristeza</span>
                    <span class="emotion-value">{{ face.sorrowLikelihood }}</span>
                  </div>
                  <div *ngIf="face.angerLikelihood" class="emotion-item">
                    <span class="emotion-icon">üò†</span>
                    <span class="emotion-label">Raiva</span>
                    <span class="emotion-value">{{ face.angerLikelihood }}</span>
                  </div>
                  <div *ngIf="face.surpriseLikelihood" class="emotion-item">
                    <span class="emotion-icon">üò≤</span>
                    <span class="emotion-label">Surpresa</span>
                    <span class="emotion-value">{{ face.surpriseLikelihood }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Label Detection -->
          <div *ngIf="results.responses?.[0]?.labelAnnotations?.length" class="result-card">
            <div class="result-header">
              <span class="result-icon">üè∑Ô∏è</span>
              <h4>R√≥tulos Detectados</h4>
              <span class="result-count">{{ results.responses[0].labelAnnotations?.length || 0 }} r√≥tulo(s)</span>
            </div>
            <div class="result-content">
              <div class="labels-grid">
                <div *ngFor="let label of results.responses[0]?.labelAnnotations || []" class="label-item">
                  <span class="label-text">{{ label.description }}</span>
                  <div class="confidence-bar">
                    <div class="confidence-fill" [style.width.%]="label.score * 100"></div>
                  </div>
                  <span class="confidence-text">{{ (label.score * 100).toFixed(1) }}%</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Text Detection -->
          <div *ngIf="results.responses?.[0]?.textAnnotations?.length" class="result-card">
            <div class="result-header">
              <span class="result-icon">üìù</span>
              <h4>Detec√ß√£o de Texto</h4>
              <span class="result-count">{{ (results.responses[0].textAnnotations?.length || 1) - 1 }} texto(s)</span>
            </div>
            <div class="result-content">
              <div *ngFor="let text of (results.responses[0]?.textAnnotations || []).slice(1)" class="text-item">
                <div class="text-content">{{ text.description }}</div>
                <div *ngIf="text.locale" class="text-meta">
                  <span class="locale-badge">{{ text.locale }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Logo Detection -->
          <div *ngIf="results.responses?.[0]?.logoAnnotations?.length" class="result-card">
            <div class="result-header">
              <span class="result-icon">üè¢</span>
              <h4>Detec√ß√£o de Logo</h4>
              <span class="result-count">{{ results.responses[0].logoAnnotations?.length || 0 }} logo(s)</span>
            </div>
            <div class="result-content">
              <div class="logos-grid">
                <div *ngFor="let logo of results.responses[0]?.logoAnnotations || []" class="logo-item">
                  <span class="logo-name">{{ logo.description }}</span>
                  <span class="confidence-badge">{{ (logo.score * 100).toFixed(0) }}%</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Landmark Detection -->
          <div *ngIf="results.responses?.[0]?.landmarkAnnotations?.length" class="result-card">
            <div class="result-header">
              <span class="result-icon">üó∫Ô∏è</span>
              <h4>Detec√ß√£o de Marco</h4>
              <span class="result-count">{{ results.responses[0].landmarkAnnotations?.length || 0 }} marco(s)</span>
            </div>
            <div class="result-content">
              <div class="landmarks-grid">
                <div *ngFor="let landmark of results.responses[0]?.landmarkAnnotations || []" class="landmark-item">
                  <span class="landmark-name">{{ landmark.description }}</span>
                  <span class="confidence-badge">{{ (landmark.score * 100).toFixed(0) }}%</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Safe Search Analysis -->
          <div *ngIf="results.responses?.[0]?.safeSearchAnnotation" class="result-card">
            <div class="result-header">
              <span class="result-icon">üõ°Ô∏è</span>
              <h4>An√°lise de Seguran√ßa de Conte√∫do</h4>
            </div>
            <div class="result-content">
              <div class="safety-grid">
                <div class="safety-item">
                  <span class="safety-label">Adulto</span>
                  <span class="safety-value" [class]="'safety-' + (results.responses[0].safeSearchAnnotation?.adult || '').toLowerCase()">
                    {{ results.responses[0].safeSearchAnnotation?.adult || 'N/A' }}
                  </span>
                </div>
                <div class="safety-item">
                  <span class="safety-label">Viol√™ncia</span>
                  <span class="safety-value" [class]="'safety-' + (results.responses[0].safeSearchAnnotation?.violence || '').toLowerCase()">
                    {{ results.responses[0].safeSearchAnnotation?.violence || 'N/A' }}
                  </span>
                </div>
                <div class="safety-item">
                  <span class="safety-label">Conte√∫do Sensual</span>
                  <span class="safety-value" [class]="'safety-' + (results.responses[0].safeSearchAnnotation?.racy || '').toLowerCase()">
                    {{ results.responses[0].safeSearchAnnotation?.racy || 'N/A' }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- No Results Message -->
          <div *ngIf="!results.responses?.[0]?.faceAnnotations?.length && 
                       !results.responses[0]?.labelAnnotations?.length && 
                       !results.responses[0]?.textAnnotations?.length &&
                       !results.responses[0]?.logoAnnotations?.length &&
                       !results.responses[0]?.landmarkAnnotations?.length" 
               class="no-results-card">
            <div class="no-results-content">
              <span class="no-results-icon">üîç</span>
              <h4>Nenhum resultado espec√≠fico encontrado</h4>
              <p>Tente selecionar outros tipos de detec√ß√£o ou usar uma imagem diferente.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
